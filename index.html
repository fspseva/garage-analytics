<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garage Analytics Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        popover: {
                            DEFAULT: "hsl(var(--popover))",
                            foreground: "hsl(var(--popover-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                }
            },
        }
    </script>
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 222.2 47.4% 11.2%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 222.2 84% 4.9%;
            --radius: 0.5rem;
        }
        
        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --popover: 222.2 84% 4.9%;
            --popover-foreground: 210 40% 98%;
            --primary: 210 40% 98%;
            --primary-foreground: 222.2 47.4% 11.2%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 212.7 26.8% 83.9%;
        }
        
        * {
            border-color: hsl(var(--border));
        }
        
        body {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
        }
        
        .card {
            background-color: hsl(var(--card));
            color: hsl(var(--card-foreground));
            border: 1px solid hsl(var(--border));
            border-radius: calc(var(--radius) + 2px);
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            border-radius: 9999px;
            border: 1px solid transparent;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .badge-default {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }
        
        .badge-secondary {
            background-color: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }
        
        .badge-outline {
            color: hsl(var(--foreground));
            border-color: hsl(var(--border));
        }
        
        .table-row:hover {
            background-color: hsl(var(--muted) / 0.5);
        }
    </style>
</head>
<body class="min-h-screen bg-background">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <div class="w-64 border-r bg-card">
            <div class="p-6">
                <div class="flex items-center space-x-2">
                    <div class="h-8 w-8 bg-primary rounded-md"></div>
                    <h2 class="text-lg font-semibold">Garage Analytics</h2>
                </div>
            </div>
            <nav class="px-4 pb-4">
                <div class="space-y-1">
                    <a href="#overview" class="flex items-center rounded-md px-3 py-2 text-sm font-medium bg-accent text-accent-foreground">
                        <svg class="mr-3 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0v11.25A2.25 2.25 0 0118 16.5h-2.25m0-11.25v-11.25m0 11.25H9.75m4.5 0a2.25 2.25 0 01-4.5 0m4.5 0a2.25 2.25 0 004.5 0" />
                        </svg>
                        Overview
                    </a>
                    <a href="#collections" class="flex items-center rounded-md px-3 py-2 text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground">
                        <svg class="mr-3 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 6.878V6a2.25 2.25 0 012.25-2.25h7.5A2.25 2.25 0 0118 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 004.5 9v.878m13.5-3A2.25 2.25 0 0119.5 9v.878m-15 0A2.25 2.25 0 004.5 12v6a2.25 2.25 0 002.25 2.25h10.5A2.25 2.25 0 0019.5 18v-6a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6zM10.5 16.5h3" />
                        </svg>
                        Collections
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1">
            <!-- Header -->
            <header class="border-b bg-card/50">
                <div class="flex h-16 items-center px-6">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-lg font-semibold">Dashboard</h1>
                        <div class="badge badge-secondary">Live Data</div>
                    </div>
                    <div class="ml-auto flex items-center space-x-4">
                        <button id="refresh-btn" class="inline-flex items-center rounded-md border px-4 py-2 text-sm font-medium hover:bg-accent">
                            <svg class="mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>
            </header>

            <!-- Overview Section -->
            <div id="overview" class="p-6">
                <!-- Summary Cards -->
                <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6">
                    <div class="card p-6">
                        <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                            <p class="text-sm font-medium text-muted-foreground">Total Volume</p>
                            <svg class="h-4 w-4 text-muted-foreground" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941" />
                            </svg>
                        </div>
                        <div class="space-y-1">
                            <p id="total-volume" class="text-2xl font-bold">Loading...</p>
                            <p class="text-xs text-muted-foreground">FUEL tokens</p>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                            <p class="text-sm font-medium text-muted-foreground">Avg Floor Price</p>
                            <svg class="h-4 w-4 text-muted-foreground" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12s-1.536.219-2.121.659c-1.172.879-1.172 2.303 0 3.182l.879.659z" />
                            </svg>
                        </div>
                        <div class="space-y-1">
                            <p id="avg-floor-price" class="text-2xl font-bold">Loading...</p>
                            <p class="text-xs text-muted-foreground">FUEL tokens</p>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                            <p class="text-sm font-medium text-muted-foreground">Total Listed</p>
                            <svg class="h-4 w-4 text-muted-foreground" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 17.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                            </svg>
                        </div>
                        <div class="space-y-1">
                            <p id="total-listed" class="text-2xl font-bold">Loading...</p>
                            <p class="text-xs text-muted-foreground">Items listed</p>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                            <p class="text-sm font-medium text-muted-foreground">Total Sales</p>
                            <svg class="h-4 w-4 text-muted-foreground" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                            </svg>
                        </div>
                        <div class="space-y-1">
                            <p id="total-sales" class="text-2xl font-bold">Loading...</p>
                            <p class="text-xs text-muted-foreground">All-time sales</p>
                        </div>
                    </div>
                </div>

                <!-- Collections Ranking -->
                <div class="card">
                    <div class="border-b p-6">
                        <h3 class="text-lg font-semibold">Collections Ranking</h3>
                        <p class="text-sm text-muted-foreground">Live marketplace data</p>
                    </div>
                    <div class="p-0">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="border-b bg-muted/20">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-muted-foreground">Rank</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-muted-foreground">Collection</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-muted-foreground">Volume (FUEL)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-muted-foreground">Floor Price</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-muted-foreground">Sales</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-muted-foreground">Listed Items</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-muted-foreground">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="collections-table" class="divide-y divide-border">
                                    <tr>
                                        <td colspan="7" class="px-6 py-8 text-center text-muted-foreground">
                                            Loading collections data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Collection Detail Modal/Section -->
            <div id="collection-detail" class="hidden p-6">
                <div class="mb-4">
                    <button id="back-to-overview" class="inline-flex items-center text-sm text-muted-foreground hover:text-foreground">
                        <svg class="mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                        </svg>
                        Back to Overview
                    </button>
                </div>
                <div id="collection-detail-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Garage API Service
        class GarageApiService {
            constructor() {
                this.baseUrl = 'https://garage-api.bako.global/mainnet';
                this.corsProxy = 'https://api.allorigins.win/get?url=';
                
                // Collection ID to name mapping
                this.collectionNames = {
                    "0xcda69aa111eb386de9e2881e039e99bc43ac21f6951e3da9b71ae4450f67858d": "Mr. Jim",
                    "0x33f6d2bf0762223229bc5b17cee8c1c0090be95dfd3ece5b63e8efb9e456ee21": "Bakteria",
                    "0xf0b6e2320caccb9071e45b1150b4da6f5edf74e7375ac6c87084822a87832de2": "BearBros",
                    "0xb03ec5c6eeaf6d09ed6755e21dff896234c8f509b813f3ff17ef14a436fa8462": "Sangoro",
                    "0x202b55f66b8bafaf3b4fdf0653f1a4320607781dbd368bb576bc09250dd7dbbe": "Koby",
                    "0x0d34ec513cbaf7e15737120725cd3e235a8fd1716fa0eedc5da4a64c182e5a9f": "FuelMonkees",
                    "0x3f3f87bb15c693784e90521c64bac855ce23d971356a6ccd57aa92e02e696432": "Executoors",
                    "0x65aa85875bf92fb5b487ade154f88507d74b233ef901b4a172f4616b527a4784": "Fuel Dudes",
                    "0x59b10bd361740618f12bba00f1083ef304a294b37ed7a8756c1b9cfc9b491b16": "Fuel BomBa",
                    "0x45c964371490bdfc2610ca116853d22a9b6e0de1abb67f61b81ab9d291b0015c": "Fuel Pumps",
                    "0xaa919d413a57cb6c577b2e172480cbe2f88df0e28203fed52249cabca6cee74a": "Fuel Pengus",
                };
            }

            async makeRequest(endpoint) {
                try {
                    // Use CORS proxy for client-side requests
                    const directUrl = `${this.baseUrl}${endpoint}`;
                    const proxyUrl = `${this.corsProxy}${encodeURIComponent(directUrl)}`;
                    const proxyResponse = await fetch(proxyUrl);
                    const proxyData = await proxyResponse.json();
                    
                    if (proxyData.contents) {
                        return JSON.parse(proxyData.contents);
                    }
                    
                    throw new Error('Unable to fetch data from API');
                } catch (error) {
                    console.error('API request failed:', error);
                    return null;
                }
            }

            async getCollections() {
                const response = await this.makeRequest('/collections');
                console.log('API Response:', response);
                
                if (!response || !response.data || !response.data.items) {
                    console.error('Invalid API response format');
                    return [];
                }

                const collections = response.data.items;
                console.log('Processing', collections.length, 'collections from API');
                
                return collections.map((item) => {
                    const id = String(item.id || '');
                    const name = String(item.name || '');
                    
                    // Get metrics - all prices in FUEL tokens
                    const metrics = item.metrics || {};
                    const volume = Number(metrics.volume || 0);
                    const floorPrice = Number(metrics.floorPrice || 0);
                    const sales = Number(String(metrics.sales || 0).replace(/[^0-9]/g, ''));
                    
                    return {
                        id,
                        name: this.collectionNames[id] || name,
                        volume,
                        floorPrice,
                        sales,
                        status: volume > 50 ? 'Active' : volume > 20 ? 'Low Activity' : 'Inactive',
                        listedItems: 0 // Will be populated separately
                    };
                }).filter(c => c.name && !c.name.startsWith('0x'));
            }

            async getCollectionNFTs(collectionId) {
                try {
                    const response = await this.makeRequest(`/collections/${collectionId}/nfts`);
                    if (response && response.data && response.data.items) {
                        return {
                            items: response.data.items,
                            total: response.data.pagination?.total || response.data.items.length
                        };
                    }
                    return { items: [], total: 0 };
                } catch (error) {
                    console.error(`Error fetching NFTs for ${collectionId}:`, error);
                    return { items: [], total: 0 };
                }
            }

            async getEnhancedCollections() {
                const collections = await this.getCollections();
                console.log('Fetching NFT counts for', collections.length, 'collections');
                
                // Get NFT counts for each collection
                const enhancedCollections = await Promise.all(
                    collections.map(async (collection) => {
                        try {
                            const nftData = await this.getCollectionNFTs(collection.id);
                            return {
                                ...collection,
                                listedItems: nftData.total
                            };
                        } catch (error) {
                            console.warn(`Could not fetch NFT count for ${collection.name}`);
                            return {
                                ...collection,
                                listedItems: 0
                            };
                        }
                    })
                );
                
                // Sort by volume descending
                return enhancedCollections.sort((a, b) => b.volume - a.volume);
            }

            async getMarketMetrics() {
                const collections = await this.getEnhancedCollections();
                
                const totalVolume = collections.reduce((sum, col) => sum + col.volume, 0);
                const validFloorPrices = collections.filter(col => col.floorPrice > 0);
                const avgFloorPrice = validFloorPrices.length > 0 
                    ? validFloorPrices.reduce((sum, col) => sum + col.floorPrice, 0) / validFloorPrices.length 
                    : 0;
                const totalSales = collections.reduce((sum, col) => sum + col.sales, 0);
                const totalListed = collections.reduce((sum, col) => sum + col.listedItems, 0);
                
                return {
                    totalVolume,
                    avgFloorPrice,
                    totalSales,
                    totalListed,
                    collections
                };
            }
        }

        // Initialize API service
        const garageApi = new GarageApiService();

        // Dashboard functions
        function updateMetricsCards(metrics) {
            document.getElementById('total-volume').textContent = metrics.totalVolume.toFixed(2);
            document.getElementById('avg-floor-price').textContent = metrics.avgFloorPrice.toFixed(2);
            document.getElementById('total-listed').textContent = metrics.totalListed.toLocaleString();
            document.getElementById('total-sales').textContent = metrics.totalSales.toLocaleString();
        }

        function updateCollectionsTable(collections) {
            const tbody = document.getElementById('collections-table');
            tbody.innerHTML = '';

            if (!collections || collections.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-muted-foreground">
                            No collections data available
                        </td>
                    </tr>
                `;
                return;
            }

            collections.forEach((collection, index) => {
                const rank = index + 1;
                const statusClass = collection.status === 'Active' ? 'badge-default' : 
                                   collection.status === 'Low Activity' ? 'badge-secondary' : 'badge-outline';
                
                const row = document.createElement('tr');
                row.className = 'table-row cursor-pointer';
                row.onclick = () => showCollectionDetail(collection);
                
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium">#${rank}</td>
                    <td class="px-6 py-4 font-medium">${collection.name}</td>
                    <td class="px-6 py-4">${collection.volume.toFixed(2)} FUEL</td>
                    <td class="px-6 py-4">${collection.floorPrice.toFixed(2)} FUEL</td>
                    <td class="px-6 py-4">${collection.sales}</td>
                    <td class="px-6 py-4">${collection.listedItems}</td>
                    <td class="px-6 py-4">
                        <span class="badge ${statusClass}">${collection.status}</span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function showCollectionDetail(collection) {
            document.getElementById('overview').classList.add('hidden');
            document.getElementById('collection-detail').classList.remove('hidden');
            
            // Load detailed collection view
            loadCollectionDetail(collection);
        }

        async function loadCollectionDetail(collection) {
            const content = document.getElementById('collection-detail-content');
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-2">${collection.name}</h2>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                            <div>
                                <p class="text-sm text-muted-foreground">Volume</p>
                                <p class="text-xl font-bold">${collection.volume.toFixed(2)} FUEL</p>
                            </div>
                            <div>
                                <p class="text-sm text-muted-foreground">Floor Price</p>
                                <p class="text-xl font-bold">${collection.floorPrice.toFixed(2)} FUEL</p>
                            </div>
                            <div>
                                <p class="text-sm text-muted-foreground">Total Sales</p>
                                <p class="text-xl font-bold">${collection.sales}</p>
                            </div>
                            <div>
                                <p class="text-sm text-muted-foreground">Listed Items</p>
                                <p class="text-xl font-bold">${collection.listedItems}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold mb-4">Recent NFTs</h3>
                        <div id="nft-grid" class="text-center text-muted-foreground">
                            Loading NFT data...
                        </div>
                    </div>
                </div>
            `;

            // Load NFTs for this collection
            try {
                const nftData = await garageApi.getCollectionNFTs(collection.id);
                const nftGrid = document.getElementById('nft-grid');
                
                if (nftData.items.length > 0) {
                    nftGrid.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${nftData.items.slice(0, 6).map(nft => `
                                <div class="card p-4">
                                    <img src="${nft.image}" alt="${nft.name}" class="w-full h-48 object-cover rounded-md mb-3" onerror="this.style.display='none'">
                                    <h4 class="font-medium">${nft.name}</h4>
                                    <p class="text-sm text-muted-foreground">${nft.id.slice(0, 10)}...</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    nftGrid.innerHTML = '<p class="text-muted-foreground">No NFT data available</p>';
                }
            } catch (error) {
                document.getElementById('nft-grid').innerHTML = '<p class="text-muted-foreground">Error loading NFT data</p>';
            }
        }

        // Initialize dashboard
        async function initializeDashboard() {
            try {
                console.log('Loading dashboard data...');
                
                const metrics = await garageApi.getMarketMetrics();
                
                updateMetricsCards(metrics);
                updateCollectionsTable(metrics.collections);
                
                console.log('Dashboard loaded successfully');
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize dashboard
            initializeDashboard();
            
            // Refresh button
            document.getElementById('refresh-btn').addEventListener('click', initializeDashboard);
            
            // Back button
            document.getElementById('back-to-overview').addEventListener('click', () => {
                document.getElementById('collection-detail').classList.add('hidden');
                document.getElementById('overview').classList.remove('hidden');
            });
        });

        // Auto-refresh every 5 minutes
        setInterval(initializeDashboard, 5 * 60 * 1000);
    </script>
</body>
</html>